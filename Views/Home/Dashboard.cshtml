@model SmartJobRecommender.Models.ViewModels.DashboardViewModel
@using SmartJobRecommender.Models.ViewModels
@using System.Linq

@{
    ViewData["Title"] = "Dashboard";
}

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f1f5f9; /* slate-100 */
    }

    .dashboard-card {
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        border: 1px solid #e2e8f0;
    }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px -3px rgb(0 0 0 / 0.05);
        }

    .skill-tag {
        background-color: #e0f2fe; /* Light blue */
        color: #0369a1; /* Darker blue */
    }

    .match-score-high {
        color: #10b981; /* Emerald 500 */
    }

    .match-score-medium {
        color: #fbbf24; /* Amber 500 */
    }
</style>

<!-- Navigation Bar (Omitted for brevity, assumed to be in _Layout.cshtml) -->
<!-- Main Content -->
<main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">

    <!-- Welcome Header -->
    <header class="mb-8 p-6 bg-white rounded-xl shadow-md">
        <h1 class="text-3xl font-bold text-gray-900">Welcome Back, <span id="user-email">@Model.UserName</span>!</h1>
        <p class="mt-2 text-lg text-gray-600">Your personalized career overview and roadmap.</p>
    </header>

    <!-- Dashboard Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

        <!-- Column 1: Core Profile Status -->
        <div class="lg:col-span-1 space-y-6">

            <!-- Profile Card -->
            <div class="dashboard-card bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-bold text-gray-900 border-b pb-3 mb-4">Your Skill Profile</h2>
                <p class="text-sm text-gray-600 mb-3">Total Skills Found: <span class="font-semibold text-blue-600">@Model.TotalSkills</span></p>
                <div id="user-skills-summary" class="flex flex-wrap gap-2">
                    @if (Model.UserSkills.Any())
                    {
                        @foreach (var skill in Model.UserSkills)
                        {
                            <span class="skill-tag px-3 py-1 rounded-full text-xs font-semibold">@skill</span>
                        }
                    }
                    else
                    {
                        <p class="text-sm text-gray-500">No skills found. Run the Resume Analyzer!</p>
                    }
                </div>
                <div class="mt-4">
                    <a href="/Home/Analyze" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                        Run New Analysis &rarr;
                    </a>
                </div>
            </div>

            <!-- Action Card -->
            <div class="dashboard-card bg-white p-6 rounded-xl shadow-md text-center">
                <h2 class="text-xl font-bold text-gray-900 mb-3">Next Critical Steps</h2>
                @if (Model.CriticalMissingSkills.Any())
                {
                    <p class="text-sm text-red-500 font-semibold mb-4">You are missing @Model.CriticalMissingSkills.Count() core skills for your top matches.</p>
                }
                else
                {
                    <p class="text-sm text-green-600 font-semibold mb-4">Your skills are well-matched for available jobs!</p>
                }

                <a href="/Home/Analyze" class="w-full inline-block bg-green-500 text-white px-6 py-3 rounded-md font-semibold hover:bg-green-600 transition-colors">
                    Analyze Gap & Get Courses
                </a>
            </div>

        </div>

        <!-- Column 2 & 3: Recommendations & Gaps -->
        <div class="lg:col-span-2 space-y-6">

            <!-- Recommended Jobs based on Skills -->
            <div class="dashboard-card bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-bold text-gray-900 border-b pb-3 mb-4">Top Job Matches</h2>
                <div id="recommended-jobs-list" class="space-y-4">
                    @if (Model.TopRecommendations.Any())
                    {
                        @foreach (var job in Model.TopRecommendations)
                        {
                            <div class="flex justify-between items-center p-3 bg-slate-50 rounded-lg">
                                <div>
                                    <h3 class="font-semibold text-gray-800">@job.Title (@job.Company)</h3>
                                    <p class="text-xs text-gray-500">
                                        @job.Location | Missing: @job.MissingSkills.Count()
                                    </p>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold @(job.MatchScore >= 80 ? "match-score-high" : (job.MatchScore >= 50 ? "match-score-medium" : "text-red-500"))">
                                        @job.MatchScore%
                                    </p>
                                    <a href="/Home/Analyze" class="text-blue-500 hover:text-blue-700 text-sm font-medium">View Gap &rarr;</a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-gray-500">No recent job matches. Run the resume analyzer now!</p>
                    }
                </div>
            </div>

            <!-- Open Skill Gaps -->
            <div class="dashboard-card bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-xl font-bold text-gray-900 border-b pb-3 mb-4">Critical Missing Skills</h2>
                <div id="open-gaps-list" class="space-y-4">
                    @if (Model.CriticalMissingSkills.Any())
                    {
                        @foreach (var missingSkill in Model.CriticalMissingSkills)
                        {
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded-lg">
                                <div>
                                    <h3 class="font-semibold text-gray-800">@missingSkill</h3>
                                    <p class="text-xs text-gray-500">Required by several top matches.</p>
                                </div>
                                <a href="/Home/Analyze" class="text-blue-500 hover:text-blue-700 text-sm font-medium">
                                    Find Courses &rarr;
                                </a>
                            </div>
                        }
                    }
                    else
                    {
                        <p class="text-green-600 font-medium">You have no critical missing skills for your top job matches!</p>
                    }
                </div>
            </div>
        </div>

</main>

<footer class="mt-12 py-6 text-center text-sm text-gray-500">
    &copy; 2025 Smart Job Recommender.
</footer>